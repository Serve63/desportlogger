<!doctype html>
<html lang="nl">
<head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />

  <meta name="theme-color" content="#1f2126" />
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Servé's Logboek" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="Servé's Logboek" />
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="manifest" href="manifest.webmanifest" />
 <title>Logboek - Zondag</title> 
  
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Sora:wght@400;500;600&display=swap");

    :root {
      --ink: #eef0f3;
      --muted: #c2c6cc;
      --line: #6a6f78;
      --stroke: #7a8089;
      --field: #3b3f45;
      --page-top: 113px;
      --page-bottom: 72px;
      --footer-offset: 72px;
    
      --exercise-font: 0.5rem;
      --note-font: 0.4rem;
      --mini-font: 0.75rem;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow: hidden;
      position: fixed;
      width: 100%;
      background: #1f2126;
      touch-action: pan-y;
      overscroll-behavior: none;
    }

    body::-webkit-scrollbar {
      width: 0;
      height: 0;
    }

    body {
      margin: 0;
      font-family: "Sora", system-ui, sans-serif;
      color: var(--ink);
      background: #1f2126;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: var(--page-top) 12px calc(var(--page-bottom) + env(safe-area-inset-bottom));
      -webkit-user-select: none;
      user-select: none;
    }


    input {
      -webkit-user-select: text;
      user-select: text;
    }

    
    .sheet::-webkit-scrollbar {
      width: 0;
      height: 0;
    }

    .sheet {

      scrollbar-width: none;
      width: min(980px, 100%);
      padding: 8px 2px 18px;
      position: relative;
      max-height: calc(100vh - var(--page-top) - var(--page-bottom) - env(safe-area-inset-bottom));
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y;
    }

    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      text-align: center;
      margin-bottom: 18px;
      position: relative;
      z-index: 1;
    }

    h1 {
      font-family: "Cormorant Garamond", serif;
      font-size: clamp(2.2rem, 3.8vw, 3.4rem);
      margin: 0;
      letter-spacing: 0.02em;
    }

    .training-count {
      margin-top: 72px;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--muted);
    }

    .year-trigger {
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      font: inherit;
      color: var(--ink);
      font-weight: 700;
      letter-spacing: 0.18em;
      cursor: pointer;
    }

    .day-line {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 6px;
      margin-bottom: 10px;
    }

    .day-trigger {
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      font: inherit;
      color: var(--ink);
      font-weight: 400;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      font-size: 0.7rem;
      cursor: pointer;
    }

    .grid {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .header-row {
      display: grid;
      grid-template-columns: minmax(0, 2fr) 42px 42px 42px;
      column-gap: 8px;
      align-items: end;
    }

    .grid .header {
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.5rem;
      letter-spacing: 0.12em;
      color: var(--muted);
      padding-bottom: 6px;
      text-align: center;
    }

    .grid .header.exercise-header {
      text-align: left;
    }

    .row {
      display: grid;
      grid-template-columns: minmax(0, 2fr) 42px 42px 42px;
      column-gap: 8px;
      row-gap: 10px;
      align-items: start;
    }

    .exercise-cell {
      display: grid;
      grid-template-columns: 20px 1fr;
      column-gap: 4px;
      row-gap: 4px;
      align-items: center;
      min-width: 0;
    }

    .drag-handle {
      grid-column: 1;
      grid-row: 1;
      align-self: start;
      width: 44px;
      height: 44px;
      margin: -12px;
      border: none;
      background: transparent;
      box-shadow: none;
      color: #eef0f3;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: grab;
      -webkit-user-select: none;
      user-select: none;
      touch-action: none;
      padding: 0;
    }

    .drag-handle::before {
      content: "";
      display: block;
      width: 12px;
      height: 2px;
      background: #eef0f3;
      box-shadow: 0 4px 0 #eef0f3, 0 8px 0 #eef0f3;
      border-radius: 1px;
    }

    .row.is-dragging {
      opacity: 0.85;
      background: rgba(47, 51, 56, 0.95);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.35);
      position: relative;
      z-index: 100;
    }

    body.is-dragging-active {
      cursor: grabbing;
    }

    .exercise-cell .exercise-name,
    .exercise-cell .exercise-note {
      font-style: italic;
      grid-column: 2;
      grid-row: 2;
      border: none;
      background: transparent;
      padding: 2px 0;
      color: var(--ink);
      font: inherit;
    }

    .exercise-cell .exercise-name {
      grid-column: 2;
      grid-row: 1;
      font-size: 1rem;
      font-weight: 500;
    }

    .exercise-cell .exercise-note {
      grid-column: 2;
      grid-row: 2;
      color: #c6c8cc;
      font-size: var(--note-font);
    }

    .mini-wrap {
      display: flex;
      justify-content: center;
    }

    .mini-field {
      border: none;
      background: var(--field);
      border-radius: 6px;
      width: 42px;
      height: 42px;
      padding: 0;
      text-align: center;
      font-size: var(--mini-font);
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--ink);
    }

    .year-modal,
    .day-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(10, 10, 12, 0.45);
      z-index: 1000;
      padding: 24px;
    }

    .year-modal.is-open,
    .day-modal.is-open {
      display: flex;
    }

    .year-modal__content,
    .day-modal__content {
      width: min(420px, 100%);
      background: #3b3f45;
      color: #f1f2f4;
      border-radius: 14px;
      padding: 20px 20px 18px;
      border: 1px solid #b9bcc3;
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.35);
      position: relative;
    }

    .year-modal__content h2,
    .day-modal__content h2 {
      margin: 0 0 12px;
      font-size: 1.05rem;
    }

    .year-modal__list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: 8px;
      font-size: 0.95rem;
    }

    .year-total {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #b9bcc3;
    }

    .day-modal__grid {
      display: grid;
      gap: 8px;
    }

    .day-modal__grid a {
      text-decoration: none;
      color: #f1f2f4;
      background: #2f3338;
      border: 1px solid #b9bcc3;
      border-radius: 10px;
      padding: 8px 10px;
      font-weight: 600;
      text-align: center;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      transition: transform 0.1s ease, background-color 0.15s ease, opacity 0.1s ease;
      cursor: pointer;
    }

    .day-modal__grid a:hover {
      background: #3b3f45;
    }

    .day-modal__grid a:active {
      transform: scale(0.96);
      opacity: 0.85;
    }

    .day-modal__grid a.is-today {
      color: #2ea043;
    }

    .exercise-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(10, 10, 12, 0.45);
      z-index: 1000;
      padding: 24px;
    }

    .exercise-modal.is-open {
      display: flex;
    }

    .exercise-modal__content {
      width: min(320px, 90%);
      background: #3b3f45;
      color: #f1f2f4;
      border-radius: 14px;
      padding: 20px 20px 18px;
      border: 1px solid #b9bcc3;
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.35);
      position: relative;
    }

    .exercise-modal__content h2 {
      margin: 0 0 16px;
      font-size: 1.05rem;
    }

    .exercise-modal__actions {
      display: grid;
      gap: 10px;
    }

    .exercise-modal__actions button {
      text-decoration: none;
      color: #f1f2f4;
      background: #2f3338;
      border: 1px solid #b9bcc3;
      border-radius: 10px;
      padding: 12px 16px;
      font-weight: 600;
      text-align: center;
      font-size: 0.95rem;
      cursor: pointer;
      font-family: inherit;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    .exercise-modal__actions button:hover {
      background: #3b3f45;
    }

    .exercise-modal__actions button.delete {
      color: #ff6b6b;
      border-color: #ff6b6b;
    }

    .exercise-modal__actions button.delete:hover {
      background: rgba(255, 107, 107, 0.1);
    }

    .year-modal__close,
    .day-modal__close,
    .exercise-modal__close {
      position: absolute;
      top: 10px;
      right: 12px;
      border: none;
      background: transparent;
      font-size: 1.5rem;
      cursor: pointer;
      color: #f1f2f4;
    }

    
    html.not-today .footer-toggle,
    body.not-today .footer-toggle {
      display: none;
    }
    .footer-toggle {
      touch-action: none;
      position: fixed;
      bottom: calc(var(--footer-offset) + env(safe-area-inset-bottom));
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      pointer-events: auto;
      z-index: 1000;
    }

    .footer-check {
      pointer-events: auto;
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: #2f3338;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
    }

    .footer-check.is-on {
      background: #2ea043;
      border-color: #2ea043;
    }

    .footer-check.is-on::after {
      content: "✓";
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      color: #eaffef;
    }

    @media (max-width: 720px) {
      .footer-toggle {
        transform: translateY(44px);
      }
      body {
        padding: var(--page-top) 16px calc(var(--page-bottom) + env(safe-area-inset-bottom));
      }

      :root {
        --page-top: 73px;
        --page-bottom: 96px;
        --footer-offset: 68px;
      
        --exercise-font: 10px;
        --note-font: 9px;
        --mini-font: 16px;
      }

      header {
        gap: 6px;
        margin-bottom: 12px;
      }

      h1 {
        font-size: clamp(1.8rem, 6vw, 2.2rem);
      }

      .training-count {
        margin-top: 12px;
        font-size: 0.7rem;
        letter-spacing: 0.14em;
      }

      .header-row {
        grid-template-columns: minmax(0, 1.4fr) 40px 40px 40px;
        column-gap: 10px;
      }

      .row {
        grid-template-columns: minmax(0, 1.4fr) 40px 40px 40px;
        column-gap: 10px;
      }

      .mini-field {
        width: 40px;
        height: 40px;
      }
    }

    @media (max-width: 520px) {
      .header-row {
        grid-template-columns: minmax(0, 1fr) 36px 36px 36px;
        column-gap: 8px;
      }

      .row {
        grid-template-columns: minmax(0, 1fr) 36px 36px 36px;
        column-gap: 8px;
      }

      .mini-field {
        width: 36px;
        height: 36px;
      }
    }
  

    .confetti-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      margin: 0;
      padding: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 9999;
    }

    .confetti {
      position: absolute;
      top: -20px;
      opacity: 0;
      animation: confettiFall var(--fall-duration, 4s) var(--fall-delay, 0s) ease-out forwards;
    }

    @keyframes confettiFall {
      0% {
        opacity: 1;
        transform: translateY(0) translateX(0) rotateX(0deg) rotateY(0deg) rotateZ(0deg);
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        opacity: 0;
        transform:
          translateY(calc(100vh + 50px))
          translateX(var(--sway, 0px))
          rotateX(var(--spin-x, 720deg))
          rotateY(var(--spin-y, 540deg))
          rotateZ(var(--spin-z, 360deg));
      }
    }

</style>

</head>
<body>
  <script id="todayGuard">
    (function() {
      try {
        const path = window.location.pathname;
        const getPageDayNumber = () => {
          if (path.includes("dinsdag")) return 2;
          if (path.includes("woensdag")) return 3;
          if (path.includes("donderdag")) return 4;
        if (path.includes("vrijdag")) return 5;
          if (path.includes("zaterdag")) return 6;
          if (path.includes("zondag")) return 0;
          return 1;
        };
        const isToday = new Date().getDay() === getPageDayNumber();
        document.documentElement.classList.toggle("not-today", !isToday);
        document.addEventListener("DOMContentLoaded", () => {
          if (!isToday) {
            const ft = document.querySelector(".footer-toggle");
            if (ft) ft.remove();
          }
        });
      } catch (e) {
        // silent
      }
    })();
  </script>
 <main class="sheet"> <header> <div> <div class="training-count"><button class="year-trigger" type="button">2026:</button> Laden...</div> <h1>Servé's Logboek</h1> <div class="day-line"><button class="day-trigger" type="button">Vandaag</button></div></div>
</header> <section class="grid" aria-label="Oefeningen">
      <div class="header-row">
        <div class="header exercise-header"></div> <div class="header">SETS</div> <div class="header">REPS</div> <div class="header">KG</div></div> <div class="row"> <div class="exercise-cell"> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" class="exercise-name" type="text" name="oefening-1" value="Shoulder Press Machine" /> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" type="text" class="exercise-note" name="note-1" /></div> <div class="mini-wrap" data-label="Sets"><input type="text" class="mini-field" name="sets-1" data-max="9" inputmode="numeric" pattern="[0-9]*" maxlength="1" value="3" /></div> <div class="mini-wrap" data-label="Reps"><input type="text" class="mini-field" name="reps-1" data-max="30" inputmode="numeric" pattern="[0-9]*" maxlength="2" /></div> <div class="mini-wrap" data-label="Gewicht"><input type="text" class="mini-field" name="gewicht-1" data-max="999" inputmode="numeric" pattern="[0-9]*" maxlength="3" /></div></div> <div class="row"> <div class="exercise-cell"> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" class="exercise-name" type="text" name="oefening-2" value="Lateral Shoulder Machine" /> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" type="text" class="exercise-note" name="note-2" /></div> <div class="mini-wrap" data-label="Sets"><input type="text" class="mini-field" name="sets-2" data-max="9" inputmode="numeric" pattern="[0-9]*" maxlength="1" value="3" /></div> <div class="mini-wrap" data-label="Reps"><input type="text" class="mini-field" name="reps-2" data-max="30" inputmode="numeric" pattern="[0-9]*" maxlength="2" /></div> <div class="mini-wrap" data-label="Gewicht"><input type="text" class="mini-field" name="gewicht-2" data-max="999" inputmode="numeric" pattern="[0-9]*" maxlength="3" /></div></div> <div class="row"> <div class="exercise-cell"> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" class="exercise-name" type="text" name="oefening-3" value="Rear Delt Machine" /> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" type="text" class="exercise-note" name="note-3" /></div> <div class="mini-wrap" data-label="Sets"><input type="text" class="mini-field" name="sets-3" data-max="9" inputmode="numeric" pattern="[0-9]*" maxlength="1" value="3" /></div> <div class="mini-wrap" data-label="Reps"><input type="text" class="mini-field" name="reps-3" data-max="30" inputmode="numeric" pattern="[0-9]*" maxlength="2" /></div> <div class="mini-wrap" data-label="Gewicht"><input type="text" class="mini-field" name="gewicht-3" data-max="999" inputmode="numeric" pattern="[0-9]*" maxlength="3" /></div></div> <div class="row"> <div class="exercise-cell"> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" class="exercise-name" type="text" name="oefening-4" value="Shrugs" /> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" type="text" class="exercise-note" name="note-4" /></div> <div class="mini-wrap" data-label="Sets"><input type="text" class="mini-field" name="sets-4" data-max="9" inputmode="numeric" pattern="[0-9]*" maxlength="1" value="3" /></div> <div class="mini-wrap" data-label="Reps"><input type="text" class="mini-field" name="reps-4" data-max="30" inputmode="numeric" pattern="[0-9]*" maxlength="2" /></div> <div class="mini-wrap" data-label="Gewicht"><input type="text" class="mini-field" name="gewicht-4" data-max="999" inputmode="numeric" pattern="[0-9]*" maxlength="3" /></div></div> <div class="row"> <div class="exercise-cell"> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" class="exercise-name" type="text" name="oefening-5" value="Calf Raises" /> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" type="text" class="exercise-note" name="note-5" /></div> <div class="mini-wrap" data-label="Sets"><input type="text" class="mini-field" name="sets-5" data-max="9" inputmode="numeric" pattern="[0-9]*" maxlength="1" value="3" /></div> <div class="mini-wrap" data-label="Reps"><input type="text" class="mini-field" name="reps-5" data-max="30" inputmode="numeric" pattern="[0-9]*" maxlength="2" /></div> <div class="mini-wrap" data-label="Gewicht"><input type="text" class="mini-field" name="gewicht-5" data-max="999" inputmode="numeric" pattern="[0-9]*" maxlength="3" /></div></div> <div class="row"> <div class="exercise-cell"> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" class="exercise-name" type="text" name="oefening-6" value="Seated Leg Curl" /> <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" type="text" class="exercise-note" name="note-6" /></div> <div class="mini-wrap" data-label="Sets"><input type="text" class="mini-field" name="sets-6" data-max="9" inputmode="numeric" pattern="[0-9]*" maxlength="1" value="3" /></div> <div class="mini-wrap" data-label="Reps"><input type="text" class="mini-field" name="reps-6" data-max="30" inputmode="numeric" pattern="[0-9]*" maxlength="2" /></div> <div class="mini-wrap" data-label="Gewicht"><input type="text" class="mini-field" name="gewicht-6" data-max="999" inputmode="numeric" pattern="[0-9]*" maxlength="3" /></div></div></section></main> <div class="year-modal" id="yearModal" aria-hidden="true"> <div class="year-modal__content" role="dialog" aria-modal="true" aria-labelledby="yearModalTitle"> <button class="year-modal__close" type="button" aria-label="Sluiten">&times;</button> <h2 id="yearModalTitle">Voorgaande jaren</h2> <ul class="year-modal__list"> <li><strong>2022:</strong> 10</li> <li><strong>2023:</strong> 5</li> <li><strong>2024:</strong> 22</li> <li><strong>2025:</strong> 301</li> <li id="yearCount2026"><strong>2026 (tot heden):</strong> 23</li> <li class="year-total"><strong>Totaal:</strong> 358 sessies</li></ul></div></div>

  <div class="day-modal" id="dayModal" aria-hidden="true">
    <div class="day-modal__content" role="dialog" aria-modal="true" aria-labelledby="dayModalTitle">
      <button class="day-modal__close" type="button" aria-label="Sluiten">&times;</button>
      <h2 id="dayModalTitle">Kies een dag</h2>
      <div class="day-modal__grid">
        <a href="index.html">Maandag</a>
        <a href="dinsdag.html">Dinsdag</a>
        <a href="woensdag.html">Woensdag</a>
        <a href="donderdag.html">Donderdag</a>
        <a href="vrijdag.html">Vrijdag</a>
        <a href="zaterdag.html">Zaterdag</a>
        <a href="zondag.html">Zondag</a>
      </div>
    </div>
  </div>

  <div class="exercise-modal" id="exerciseModal" aria-hidden="true">
    <div class="exercise-modal__content" role="dialog" aria-modal="true">
      <div class="exercise-modal__actions">
        <button type="button" class="add-exercise">Nieuwe oefening toevoegen</button>
        <button type="button" class="delete-exercise delete">Oefening verwijderen</button>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  
  <script>
    (() => {
      const APP_VERSION = "2026-01-28-9";
      const withVersion = (url) => {
        const separator = url.includes("?") ? "&" : "?";
        return `${url}${separator}v=${APP_VERSION}`;
      };

      // Redirect naar de juiste dag pagina als het niet vandaag is
      const today = new Date().getDay(); // 0 = zondag, 1 = maandag, etc.
      const dayPages = {
        0: "zondag.html",   // Zondag
        1: "index.html",     // Maandag
        2: "dinsdag.html",   // Dinsdag
        3: "woensdag.html",  // Woensdag
        4: "donderdag.html", // Donderdag
        5: "vrijdag.html",     // Vrijdag (geen aparte pagina, gebruik maandag)
        6: "zaterdag.html"   // Zaterdag
      };
      
      const todayPage = dayPages[today];
      const currentPage = window.location.pathname.split("/").pop() || "index.html";
      const currentUrl = new URL(window.location.href);
      const manualView = currentUrl.searchParams.get("manual") === "1";
      
      // Als de huidige pagina niet de pagina van vandaag is, redirect (behalve bij handmatige keuze)
      if (currentPage !== todayPage && !manualView) {
        window.location.replace(withVersion(todayPage));
        return; // Stop verdere uitvoering
      }

      if (currentUrl.searchParams.get("v") !== APP_VERSION) {
        currentUrl.searchParams.set("v", APP_VERSION);
        window.location.replace(currentUrl.toString());
        return;
      }

      const dayTrigger = document.querySelector(".day-trigger");
      const dayModal = document.getElementById("dayModal");
      const dayClose = document.querySelector(".day-modal__close");

      if (dayTrigger && dayModal && dayClose) {
        const openDayModal = () => {
          dayModal.classList.add("is-open");
          dayModal.setAttribute("aria-hidden", "false");
        };
        const closeDayModal = () => {
          dayModal.classList.remove("is-open");
          dayModal.setAttribute("aria-hidden", "true");
        };

        dayTrigger.addEventListener("click", () => {
          if (dayModal.classList.contains("is-open")) {
            closeDayModal();
          } else {
            openDayModal();
          }
        });
        dayClose.addEventListener("click", closeDayModal);
        dayModal.addEventListener("click", (event) => {
          if (event.target === dayModal) closeDayModal();
        });
        document.addEventListener("keydown", (event) => {
          if (event.key === "Escape") closeDayModal();
        });
      }

      const setupYearTrigger = () => {
      const yearTrigger = document.querySelector(".year-trigger");
      const yearModal = document.getElementById("yearModal");
      const yearClose = document.querySelector(".year-modal__close");

      if (yearTrigger && yearModal && yearClose) {
        const openModal = () => {
          yearModal.classList.add("is-open");
          yearModal.setAttribute("aria-hidden", "false");
        };
        const closeModal = () => {
          yearModal.classList.remove("is-open");
          yearModal.setAttribute("aria-hidden", "true");
        };

          // Verwijder oude event listeners door te clonen
          const newYearTrigger = yearTrigger.cloneNode(true);
          yearTrigger.parentNode.replaceChild(newYearTrigger, yearTrigger);

          newYearTrigger.addEventListener("click", () => {
          if (yearModal.classList.contains("is-open")) {
            closeModal();
          } else {
            openModal();
          }
        });
          
          // Setup close button en modal events (alleen eenmalig)
          if (!yearClose.dataset.listenerAttached) {
        yearClose.addEventListener("click", closeModal);
            yearClose.dataset.listenerAttached = "true";
        yearModal.addEventListener("click", (event) => {
          if (event.target === yearModal) closeModal();
        });
        document.addEventListener("keydown", (event) => {
          if (event.key === "Escape") closeModal();
        });
      }
        }
      };

      // Initialiseer year trigger bij het laden
      setupYearTrigger();

      // Update day-trigger button tekst: "Vandaag" als het vandaag is, anders de dag naam
      const updateDayTriggerText = () => {
        const dayTrigger = document.querySelector(".day-trigger");
        if (!dayTrigger) return;

        // Bepaal welke dag deze pagina representeert
        const getPageDay = () => {
          const path = window.location.pathname;
          if (path.includes("dinsdag")) return 2; // Dinsdag = 2
          if (path.includes("woensdag")) return 3; // Woensdag = 3
          if (path.includes("donderdag")) return 4; // Donderdag = 4
          if (path.includes("vrijdag")) return 5; // Vrijdag = 5
          if (path.includes("zaterdag")) return 6; // Zaterdag = 6
          if (path.includes("zondag")) return 0; // Zondag = 0
          return 1; // Maandag = 1 (default voor index.html)
        };

        // Bepaal de dag namen
        const dayNames = ["Zondag", "Maandag", "Dinsdag", "Woensdag", "Donderdag", "Vrijdag", "Zaterdag"];
        
        const today = new Date().getDay(); // 0 = zondag, 1 = maandag, etc.
        const pageDay = getPageDay();
        const pageDayName = dayNames[pageDay];

        // Als het vandaag dezelfde dag is als de pagina, toon "Vandaag", anders de dag naam
        dayTrigger.textContent = today === pageDay ? "Vandaag" : pageDayName;
      };

      // Update de button tekst bij het laden
      updateDayTriggerText();

      // Update dag-menu links: toon "Vandaag" voor de huidige dag
      const updateDayModalLinks = () => {
        const dayModalLinks = document.querySelectorAll(".day-modal__grid a");
        if (!dayModalLinks.length) return;

        const today = new Date().getDay(); // 0 = zondag, 1 = maandag, etc.
        const dayMapping = {
          "index.html": 1,      // Maandag
          "dinsdag.html": 2,    // Dinsdag
          "woensdag.html": 3,   // Woensdag
          "donderdag.html": 4,   // Donderdag
          "zaterdag.html": 6,    // Zaterdag
          "zondag.html": 0       // Zondag
        };

        dayModalLinks.forEach((link) => {
          const rawHref = link.getAttribute("href") || "";
          const baseHref = rawHref.split("?")[0];
          const dayNumber = dayMapping[baseHref];

          if (baseHref) {
            const manualHref = `${baseHref}?manual=1`;
            link.setAttribute("href", withVersion(manualHref));
          }
          
          if (dayNumber !== undefined && dayNumber === today) {
            // Bewaar de originele tekst in een data attribuut
            if (!link.dataset.originalText) {
              link.dataset.originalText = link.textContent;
            }
            link.textContent = "Vandaag";
            link.classList.add("is-today");
          } else {
            // Herstel de originele tekst als het niet meer vandaag is
            if (link.dataset.originalText) {
              link.textContent = link.dataset.originalText;
              delete link.dataset.originalText;
            }
            link.classList.remove("is-today");
          }
        });
      };

      // Update de menu links bij het laden
      updateDayModalLinks();


      const clampInput = (input) => {
        const max = Number(input.dataset.max || 999);
        input.addEventListener("input", () => {
          let value = input.value.replace(/\D+/g, "");
          if (value === "") {
            input.value = "";
            return;
          }
          const num = Number(value);
          input.value = String(Math.min(num, max));
        });
      };

      document.querySelectorAll("input[data-max]").forEach(clampInput);

      // Cursor altijd achter het laatste cijfer plaatsen bij focus
      const cursorToEnd = (input) => {
        input.addEventListener("focus", () => {
          setTimeout(() => {
            const len = input.value.length;
            input.setSelectionRange(len, len);
          }, 0);
        });
      };
      document.querySelectorAll(".mini-field").forEach(cursorToEnd);

      const launchConfetti = () => {
        const layer = document.createElement("div");
        layer.className = "confetti-layer";
        document.documentElement.appendChild(layer);

        const viewportWidth = window.innerWidth || document.documentElement.clientWidth;

        const createTrophy = () => {
          const piece = document.createElement("span");
          piece.className = "confetti";
          piece.textContent = "\uD83C\uDFC6";

          const x = Math.random() * viewportWidth;
          piece.style.left = x + "px";

          const size = 16 + Math.random() * 20;
          piece.style.fontSize = size + "px";
          piece.style.lineHeight = "1";

          const fallDuration = 2.5 + Math.random() * 2.5;
          piece.style.setProperty('--fall-duration', fallDuration + 's');

          const delay = Math.random() * 0.8;
          piece.style.setProperty('--fall-delay', delay + 's');

          const sway = (Math.random() - 0.5) * 160;
          piece.style.setProperty('--sway', sway + 'px');

          piece.style.setProperty('--spin-x', (Math.random() * 40 - 20) + 'deg');
          piece.style.setProperty('--spin-y', (Math.random() * 40 - 20) + 'deg');
          piece.style.setProperty('--spin-z', (Math.random() * 60 - 30) + 'deg');

          return piece;
        };

        const createTrophyBatch = (count) => {
          for (let i = 0; i < count; i++) {
            layer.appendChild(createTrophy());
          }
        };

        createTrophyBatch(30);

        let elapsed = 0;
        const interval = setInterval(() => {
          elapsed += 300;
          createTrophyBatch(6);

          if (elapsed >= 3000) {
            clearInterval(interval);
            setTimeout(() => layer.remove(), 6000);
          }
        }, 300);
      };

      if (!window.supabase) {
        console.error("Supabase library niet geladen!");
        return;
      }

      console.log("Supabase library gevonden, client aanmaken...");
      const supabase = window.supabase.createClient(
        "https://lqgcitosiyahgwqluwtb.supabase.co",
        "sb_publishable_dGMK5ruFsyWkF3ne43AS1A_lHURUBhI"
      );
      console.log("Supabase client aangemaakt");

      // Functie om sessie count op te halen en bij te werken
      const getSessionCount = async () => {
        try {
          const currentYear = new Date().getFullYear();
          const baselineCount = currentYear === 2026 ? 21 : 0;
          const { data, error } = await supabase
            .from("session_counts")
            .select("count")
            .eq("year", currentYear)
            .single();
          
          if (error) {
            // PGRST116 = geen resultaten gevonden
            if (error.code === 'PGRST116' || error.message?.includes('No rows')) {
              console.log("No session count found, creating new record");
              const { data: newData, error: insertError } = await supabase
                .from("session_counts")
                .insert({ year: currentYear, count: baselineCount })
                .select()
                .single();
              
              if (insertError) {
                console.error("Error creating session count:", insertError);
                return baselineCount; // Fallback
              }
              
              return newData?.count ?? baselineCount;
            } else {
              console.error("Error getting session count:", error);
              return baselineCount; // Fallback
            }
          }
          
          return data?.count ?? baselineCount;
        } catch (error) {
          console.error("Error in getSessionCount:", error);
          return new Date().getFullYear() === 2026 ? 21 : 0;
        }
      };

      const reconcileSessionCount = async (count) => {
        const currentYear = new Date().getFullYear();
        let target = count;

        if (currentYear === 2026 && target < 21) {
          target = 21;
        }

        if (target !== count) {
          const { error } = await supabase
            .from("session_counts")
            .upsert({ year: currentYear, count: target }, { onConflict: 'year' });

          if (error) {
            console.error("Error correcting session count:", error);
            return count;
          }
        }

        return target;
      };

      const updateSessionCount = async (increment = true) => {
        try {
          console.log(increment ? "incrementSessionCount called" : "decrementSessionCount called");
          const currentYear = new Date().getFullYear();
          console.log("Current year:", currentYear);
          
          const currentCount = await getSessionCount();
          console.log("Current count:", currentCount);
          
          const newCount = increment ? currentCount + 1 : Math.max(0, currentCount - 1);
          console.log("New count:", newCount);
          
          const { data, error } = await supabase
            .from("session_counts")
            .upsert({ year: currentYear, count: newCount }, { onConflict: 'year' });
          
          if (error) {
            console.error("Error updating session count:", error);
            if (error.message?.includes("Could not find the table") || error.message?.includes("relation") || error.message?.includes("does not exist")) {
              alert("De session_counts tabel bestaat nog niet in Supabase. Voer de SQL uit uit supabase.sql om de tabel aan te maken.");
            } else {
              alert("Fout bij updaten sessie count: " + error.message);
            }
            return;
          }
          
          console.log("Session count updated successfully:", data);
          updateSessionCountDisplay(newCount);
        } catch (error) {
          console.error("Error in updateSessionCount:", error);
          alert("Fout: " + error.message);
        }
      };

      const incrementSessionCount = () => updateSessionCount(true);
      const decrementSessionCount = () => updateSessionCount(false);

      const updateSessionCountDisplay = (count) => {
        const trainingCountEl = document.querySelector(".training-count");
        if (trainingCountEl) {
          const yearButton = trainingCountEl.querySelector(".year-trigger");
          const year = yearButton?.textContent?.replace(":", "") || new Date().getFullYear();
          trainingCountEl.innerHTML = `<button class="year-trigger" type="button">${year}:</button> ${count} sessies`;
          // Herstel de event listener na het updaten
          setupYearTrigger();

          const numericYear = Number(year);
          if (Number.isFinite(numericYear) && numericYear === 2026) {
            const yearItem = document.getElementById("yearCount2026");
            if (yearItem) {
              yearItem.innerHTML = `<strong>2026 (tot heden):</strong> ${count}`;
            }
          }
        }
      };
      // Initialiseer sessie counts voor alle jaren (alleen als record nog niet bestaat)
      const initializeSessionCounts = async () => {
        const yearCounts = {
          2024: 22,
          2025: 301,
          2026: 22
        };

        for (const [year, count] of Object.entries(yearCounts)) {
          const { data, error } = await supabase
            .from("session_counts")
            .select("count")
            .eq("year", parseInt(year))
            .single();

          if (error) {
            if (error.code === 'PGRST116' || error.message?.includes('No rows')) {
              const { error: insertError } = await supabase
                .from("session_counts")
                .insert({ year: parseInt(year), count })
                .select()
                .single();

              if (insertError) {
                console.error(`Error inserting count for ${year}:`, insertError);
              } else {
                console.log(`Inserted count for ${year}: ${count}`);
              }
            } else {
              console.error(`Error fetching count for ${year}:`, error);
            }
          } else {
            // Update de count als deze anders is
            if (data.count !== count) {
              const { error: updateError } = await supabase
                .from("session_counts")
                .update({ count })
                .eq("year", parseInt(year));

              if (updateError) {
                console.error(`Error updating count for ${year}:`, updateError);
              } else {
                console.log(`Updated count for ${year} to ${count}`);
              }
            }
          }
        }
      };

            // Laad de huidige sessie count en toon deze
      (async () => {
        await initializeSessionCounts();

        const count = await getSessionCount();
        let finalCount = await reconcileSessionCount(count);
        if (new Date().getFullYear() === 2026) {
          finalCount = 23;
          await supabase
            .from("session_counts")
            .upsert({ year: 2026, count: 23 }, { onConflict: "year" });
        }
        updateSessionCountDisplay(finalCount);
      })();

      const todayStr = new Date().toLocaleDateString('en-CA');
      const sessionCompleteKey = `session_complete_${todayStr}`;
      const storageKey = "session-checked-" + todayStr;

      const getCookie = (name) => {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
      };

      const setCookie = (name, value) => {
        document.cookie = `${name}=${value}; Max-Age=31536000; Path=/; SameSite=Lax`;
      };

      const clearCookie = (name) => {
        document.cookie = `${name}=; Max-Age=0; Path=/; SameSite=Lax`;
      };

      window.addEventListener("DOMContentLoaded", () => {
        const footerCheck = document.querySelector(".footer-check");
        const footerToggle = document.querySelector(".footer-toggle");
        if (footerToggle) {
          const preventScroll = (event) => {
            if (event.cancelable) event.preventDefault();
          };
          footerToggle.addEventListener("touchmove", preventScroll, { passive: false });
        }
        if (!footerCheck) return;

        // Restore state for today
        if (localStorage.getItem(sessionCompleteKey) === "1") {
          footerCheck.classList.add("is-on");
        }
        let lastToggleAt = 0;
        const toggleSession = (e) => {
          if (e && e.cancelable) e.preventDefault();
          if (e) e.stopPropagation();
          const now = Date.now();
          if (now - lastToggleAt < 600) return;
          lastToggleAt = now;
          const wasOn = footerCheck.classList.contains("is-on");
          const isOn = footerCheck.classList.toggle("is-on");

          if (isOn && !wasOn) {
            localStorage.setItem(sessionCompleteKey, "1");
            localStorage.setItem(storageKey, "1");
            setCookie(storageKey, "1");
            incrementSessionCount();
            launchConfetti();
          } else if (!isOn && wasOn) {
            localStorage.removeItem(sessionCompleteKey);
            localStorage.removeItem(storageKey);
            clearCookie(storageKey);
            decrementSessionCount();
          }
        };
        footerCheck.addEventListener("pointerdown", toggleSession);
        footerCheck.addEventListener("touchstart", toggleSession);
        footerCheck.addEventListener("click", toggleSession);
        footerCheck.addEventListener("touchend", toggleSession);
      });

      // Bepaal de dag naam op basis van het bestand voor Supabase
      const getDayName = () => {
        const path = window.location.pathname;
        if (path.includes("dinsdag")) return "Dinsdag";
        if (path.includes("woensdag")) return "Woensdag";
        if (path.includes("donderdag")) return "Donderdag";
        if (path.includes("vrijdag")) return "Vrijdag";
        if (path.includes("zaterdag")) return "Zaterdag";
        if (path.includes("zondag")) return "Zondag";
        return "Maandag"; // default voor index.html
      };
      
      const day = getDayName();
      const getCurrentRows = () => Array.from(document.querySelectorAll(".row"));
      if (!day || getCurrentRows().length === 0) return;

      const getRowIndex = (row) => getCurrentRows().indexOf(row);

      const getRowData = (row, index) => {
        const nameInput = row.querySelector(".exercise-name");
        const noteInput = row.querySelector(".exercise-note");
        const setsInput = row.querySelector('input[name^="sets-"]');
        const repsInput = row.querySelector('input[name^="reps-"]');
        const weightInput = row.querySelector('input[name^="gewicht-"]');

        const toInt = (value) => {
          if (value === "" || value == null) return null;
          const num = Number(value);
          return Number.isNaN(num) ? null : num;
        };

        return {
          day,
          exercise_index: index + 1,
          exercise_name: nameInput?.value?.trim() || null,
          note: noteInput?.value?.trim() || null,
          sets: toInt(setsInput?.value),
          reps: toInt(repsInput?.value),
          weight: toInt(weightInput?.value),
        };
      };

      const upsertRow = async (row, index) => {
        if (index == null || index < 0) return;
        const payload = getRowData(row, index);
        console.log("Saving data:", payload);
        const { data, error } = await supabase
          .from("workout_entries")
          .upsert(payload, { onConflict: "day,exercise_index" })
          .select();
        if (error) {
          console.error("Supabase save failed:", error);
          console.error("Payload was:", payload);
        } else {
          console.log("Saved successfully:", data);
        }
      };

      const getColumnForInput = (input) => {
        if (input.classList.contains("exercise-name")) return "exercise_name";
        if (input.classList.contains("exercise-note")) return "note";
        const name = input.getAttribute("name") || "";
        if (name.startsWith("sets-")) return "sets";
        if (name.startsWith("reps-")) return "reps";
        if (name.startsWith("gewicht-")) return "weight";
        return null;
      };

      const clearField = async (row, input) => {
        const column = getColumnForInput(input);
        if (!column) return;
        const index = getRowIndex(row);
        if (index < 0) return;
        const { error } = await supabase
          .from("workout_entries")
          .update({ [column]: null })
          .match({ day, exercise_index: index + 1 });
        if (error) console.warn("Supabase clear failed", error);
      };

      const timers = new WeakMap();
      const scheduleSave = (row, immediate = false) => {
        if (!row) return;
        const existingTimer = timers.get(row);
        if (existingTimer) clearTimeout(existingTimer);
        const delay = immediate ? 0 : 500;
        const timer = setTimeout(() => {
          const index = getRowIndex(row);
          if (index < 0) return;
          upsertRow(row, index);
        }, delay);
        timers.set(row, timer);
      };

      // Functie om alle rows opnieuw te indexeren en op te slaan
      const reindexAndSaveAllRows = async () => {
        console.log("reindexAndSaveAllRows aangeroepen voor dag:", day);
        const allRows = Array.from(document.querySelectorAll(".row"));
        console.log("Aantal rows:", allRows.length);
        // Verwijder eerst alle oude entries voor deze dag
        const { error: deleteError } = await supabase.from("workout_entries").delete().eq("day", day);
        if (deleteError) {
          console.error("Fout bij verwijderen oude entries:", deleteError);
        } else {
          console.log("Oude entries verwijderd");
        }
        // Sla alle rows opnieuw op met nieuwe indices
        for (let i = 0; i < allRows.length; i++) {
          await upsertRow(allRows[i], i);
        }
        console.log("Alle rows opnieuw opgeslagen");
        updateDynamicLayout();
      };

      // Functie om event listeners toe te voegen aan een row
      const attachRowEventListeners = (row) => {
        row.querySelectorAll("input").forEach((input) => {
          input.addEventListener("input", () => {
            const value = input.value ?? "";
            if (value === "") {
              clearField(row, input);
              scheduleSave(row, true);
              return;
            }
            scheduleSave(row, false);
          });
          input.addEventListener("blur", () => {
            scheduleSave(row, true);
          });
        });
      };

      const buildRow = (displayIndex) => {
        const row = document.createElement("div");
        row.className = "row";
        row.innerHTML = `
            <div class="exercise-cell">
              <button class="drag-handle" type="button" aria-label="Verplaats oefening"></button>
              <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" class="exercise-name" type="text" name="oefening-${displayIndex}" placeholder="Geef je oefening een naam" />
              <input spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" type="text" class="exercise-note" name="note-${displayIndex}" />
            </div>
            <div class="mini-wrap" data-label="Sets">
              <input type="text" class="mini-field" name="sets-${displayIndex}" data-max="9" inputmode="numeric" pattern="[0-9]*" maxlength="1" value="3" />
            </div>
            <div class="mini-wrap" data-label="Reps">
              <input type="text" class="mini-field" name="reps-${displayIndex}" data-max="30" inputmode="numeric" pattern="[0-9]*" maxlength="2" />
            </div>
            <div class="mini-wrap" data-label="Gewicht">
              <input type="text" class="mini-field" name="gewicht-${displayIndex}" data-max="999" inputmode="numeric" pattern="[0-9]*" maxlength="3" />
            </div>
          `;
        return row;
      };

      const insertRowAtEnd = (row) => {
        const grid = document.querySelector(".grid");
        if (!grid || !row) return;
        const rows = getCurrentRows();
        if (rows.length > 0) {
          rows[rows.length - 1].after(row);
          return;
        }
        const headerRow = document.querySelector(".header-row");
        if (headerRow) {
          headerRow.after(row);
        } else {
          grid.appendChild(row);
        }
      };

      const insertRowBeforeLast = (row) => {
        const grid = document.querySelector(".grid");
        if (!grid || !row) return;
        const rows = getCurrentRows();
        if (rows.length === 0) {
          const headerRow = document.querySelector(".header-row");
          if (headerRow) {
            headerRow.after(row);
          } else {
            grid.appendChild(row);
          }
          return;
        }
        rows[rows.length - 1].before(row);
      };

      const insertRowBeforeSelected = (row, selectedRow) => {
        if (!row) return false;
        if (selectedRow && selectedRow.parentNode) {
          selectedRow.before(row);
          return true;
        }
        return false;
      };

      const ensureRowHandle = (row) => {
        const cell = row.querySelector(".exercise-cell");
        if (!cell) return;
        if (cell.querySelector(".drag-handle")) return;
        const handle = document.createElement("button");
        handle.className = "drag-handle";
        handle.type = "button";
        handle.setAttribute("aria-label", "Verplaats oefening");
        cell.prepend(handle);
      };

      const initRow = (row) => {
        if (!row) return;
        ensureRowHandle(row);
        row.querySelectorAll("input[data-max]").forEach(clampInput);
        row.querySelectorAll(".mini-field").forEach(cursorToEnd);
        attachRowEventListeners(row);
        if (typeof attachTouchListeners === "function") {
          attachTouchListeners(row);
        }
      };

      const updateDynamicLayout = () => {
        const rows = getCurrentRows();
        const count = rows.length;
        const isNarrow = window.matchMedia("(max-width: 720px)").matches;
        const baseSizes = isNarrow
          ? { exercise: 14, note: 10, mini: 16 }
          : { exercise: 10.5, note: 8, mini: 12 };
        const scale = count > 6 ? Math.max(0.9, 1 - (count - 6) * 0.02) : 1;

        const setVar = (name, value) => {
          document.documentElement.style.setProperty(name, `${value.toFixed(2)}px`);
        };
        setVar("--exercise-font", baseSizes.exercise * scale);
        setVar("--note-font", baseSizes.note * scale);
        setVar("--mini-font", baseSizes.mini * scale);

        const footerToggle = document.querySelector(".footer-toggle");
        if (footerToggle && rows.length && !document.body.classList.contains("not-today")) {
          const lastRow = rows[rows.length - 1];
          const footerRect = footerToggle.getBoundingClientRect();
          const buttonHeight = footerRect.height || 36;
          const viewportHeight = window.innerHeight;
          const lastRect = lastRow.getBoundingClientRect();
          const gap = 16;
          const minTop = 12;
          const maxTop = viewportHeight - buttonHeight - 12;
          const desiredTop = Math.min(lastRect.bottom + gap, maxTop);
          const finalTop = Math.max(minTop, desiredTop);
          footerToggle.style.top = `${finalTop}px`;
          footerToggle.style.bottom = "auto";
        }
      };

      getCurrentRows().forEach((row) => {
        attachRowEventListeners(row);
        ensureRowHandle(row);
      });
      updateDynamicLayout();

      window.addEventListener("resize", () => {
        updateDynamicLayout();
      });

      // Exercise context menu functionaliteit (nu met toegang tot Supabase functies)
      let attachTouchListeners = null;
      const setupExerciseContextMenu = () => {
        const exerciseModal = document.getElementById("exerciseModal");
        const addExerciseBtn = document.querySelector(".add-exercise");
        const deleteExerciseBtn = document.querySelector(".delete-exercise");
        let selectedRow = null;

        if (!exerciseModal || !addExerciseBtn || !deleteExerciseBtn) return;

        const openModal = (row) => {
          selectedRow = row;
          exerciseModal.classList.add("is-open");
          exerciseModal.setAttribute("aria-hidden", "false");
        };

        const closeModal = () => {
          exerciseModal.classList.remove("is-open");
          exerciseModal.setAttribute("aria-hidden", "true");
          selectedRow = null;
        };

        exerciseModal.addEventListener("click", (event) => {
          if (event.target === exerciseModal) closeModal();
        });
        document.addEventListener("keydown", (event) => {
          if (event.key === "Escape" && exerciseModal.classList.contains("is-open")) {
            closeModal();
          }
        });

        // Touch long press detection
        let touchTimer = null;
        const LONG_PRESS_DURATION = 500; // 500ms

        const handleTouchStart = (e, row) => {
          if (e.target && e.target.closest && e.target.closest(".drag-handle")) return;
          touchTimer = setTimeout(() => {
            e.preventDefault();
            openModal(row);
          }, LONG_PRESS_DURATION);
        };

        const handleTouchEnd = () => {
          if (touchTimer) {
            clearTimeout(touchTimer);
            touchTimer = null;
          }
        };

        const handleTouchMove = () => {
          if (touchTimer) {
            clearTimeout(touchTimer);
            touchTimer = null;
          }
        };

        // Functie om touch listeners toe te voegen aan een row
        attachTouchListeners = (row) => {
          row.addEventListener("touchstart", (e) => handleTouchStart(e, row), { passive: false });
          row.addEventListener("touchend", handleTouchEnd);
          row.addEventListener("touchmove", handleTouchMove);
          row.addEventListener("touchcancel", handleTouchEnd);
        };

        // Voeg touch event listeners toe aan alle rows
        const allRows = document.querySelectorAll(".row");
        allRows.forEach((row) => {
          attachTouchListeners(row);
        });

        // Functie om oefening te verwijderen
        deleteExerciseBtn.addEventListener("click", async () => {
          if (selectedRow) {
            console.log("Verwijderen oefening...");
            // Verwijder de row uit de DOM
            selectedRow.remove();
            closeModal();
            // Herindexeer en sla alle rows opnieuw op
            console.log("Herindexeren en opslaan...");
            await reindexAndSaveAllRows();
            console.log("Oefening verwijderd en opgeslagen");
          }
        });

        // Functie om nieuwe oefening toe te voegen
        addExerciseBtn.addEventListener("click", async () => {
          const grid = document.querySelector(".grid");
          if (!grid) return;

          // Bepaal het volgende nummer voor de nieuwe oefening
          const existingRows = getCurrentRows();
          const nextIndex = Math.max(1, existingRows.length);

          // Maak nieuwe row
          const newRow = buildRow(nextIndex);

          // Voeg toe boven de ingehouden (geselecteerde) row
          const inserted = insertRowBeforeSelected(newRow, selectedRow);
          if (!inserted) {
            insertRowBeforeLast(newRow);
          }

          // Initialiseer de nieuwe row
          initRow(newRow);

          // Herindexeer en sla alles op zodat indices blijven kloppen
          console.log("Herindexeren en opslaan...");
          await reindexAndSaveAllRows();
          console.log("Nieuwe oefening toegevoegd en opgeslagen");

          // Focus op het naam veld
          const nameInput = newRow.querySelector(".exercise-name");
          if (nameInput) {
            setTimeout(() => nameInput.focus(), 100);
          }

          closeModal();
        });
      };

      // Initialiseer exercise context menu
      setupExerciseContextMenu();

      const setupRowReorder = () => {
        const grid = document.querySelector(".grid");
        if (!grid) return;

        let draggingRow = null;

        const onPointerDown = (event) => {
          const handle = event.target.closest(".drag-handle");
          if (!handle) return;
          const row = handle.closest(".row");
          if (!row) return;
          event.preventDefault();
          grid.setPointerCapture(event.pointerId);
          draggingRow = row;
          draggingRow.classList.add("is-dragging");
          document.body.classList.add("is-dragging-active");
        };

        const onPointerMove = (event) => {
          if (!draggingRow) return;
          if (event.cancelable) event.preventDefault();
          const y = event.clientY;
          const rows = getCurrentRows().filter((r) => r !== draggingRow);
          let inserted = false;
          for (const row of rows) {
            const rect = row.getBoundingClientRect();
            const midpoint = rect.top + rect.height / 2;
            if (y < midpoint) {
              row.before(draggingRow);
              inserted = true;
              break;
            }
          }
          if (!inserted && rows.length) {
            rows[rows.length - 1].after(draggingRow);
          }
          updateDynamicLayout();
        };

        const onPointerUp = async () => {
          if (!draggingRow) return;
          draggingRow.classList.remove("is-dragging");
          document.body.classList.remove("is-dragging-active");
          draggingRow = null;
          await reindexAndSaveAllRows();
        };

        grid.addEventListener("pointerdown", onPointerDown);
        grid.addEventListener("pointermove", onPointerMove);
        grid.addEventListener("pointerup", onPointerUp);
        grid.addEventListener("pointercancel", onPointerUp);
      };

      setupRowReorder();

      (async () => {
        console.log("Loading data for day:", day);
        const { data, error } = await supabase
          .from("workout_entries")
          .select("*")
          .eq("day", day)
          .order("exercise_index");
        if (error) {
          console.error("Supabase load failed:", error);
          return;
        }
        console.log("Loaded data:", data);
        const maxIndex = data.reduce((max, item) => {
          const value = Number(item.exercise_index) || 0;
          return Math.max(max, value);
        }, 0);
        const currentRows = getCurrentRows();
        if (maxIndex > currentRows.length) {
          for (let i = currentRows.length; i < maxIndex; i++) {
            const newRow = buildRow(i + 1);
            insertRowAtEnd(newRow);
            initRow(newRow);
          }
        }
        data.forEach((item) => {
          const row = getCurrentRows()[item.exercise_index - 1];
          if (!row) return;
          const nameInput = row.querySelector(".exercise-name");
          const noteInput = row.querySelector(".exercise-note");
          const setsInput = row.querySelector('input[name^="sets-"]');
          const repsInput = row.querySelector('input[name^="reps-"]');
          const weightInput = row.querySelector('input[name^="gewicht-"]');

          if (nameInput && item.exercise_name != null) nameInput.value = item.exercise_name;
          if (noteInput && item.note != null) noteInput.value = item.note;
          if (setsInput && item.sets != null) setsInput.value = item.sets;
          if (repsInput && item.reps != null) repsInput.value = item.reps;
          if (weightInput && item.weight != null) weightInput.value = item.weight;
        });
        updateDynamicLayout();
      })();
    })();
  </script>



  <div class="footer-toggle">
    <button class="footer-check" type="button" aria-label="Markeer als afgerond"></button>
  </div>

</body>
</html>
